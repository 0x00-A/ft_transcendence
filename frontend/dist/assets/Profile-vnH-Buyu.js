import{c as os,x as G,u as T,j as s,r as v,i as ts,q as X,I as rs,J as ls,l as H,K as cs,D as $,B as S,O as ds,P as ms,Q as us,R as fs,S as ps,T as ss,U as es,V as hs,W as xs,Y as _s,Z as js,_ as bs}from"./index-erQsObJq.js";import{c as j,a as h,b as d,P as Ns,d as vs}from"./ProfileAchievements-DPnAQLb7.js";import{G as Ps}from"./iconBase-Dy7Lu4j7.js";import{F as Q}from"./FriendSkeleton-C6d5tkeq.js";import{U as ws}from"./users-CJsmYFnL.js";import{u as U,o as W,E as gs,a as J,b as Cs,V as ns,C as ys,c as Es,d as Ss,P as Bs}from"./formSchemas-CD-5kOut.js";import{B as M,a as q}from"./index-zWRPu04G.js";import{a as Fs}from"./index-nayAqekl.js";import{a as is}from"./index-D32MFD3Q.js";import{R as As}from"./index-DfG7zr7K.js";import"./helpers-BRqGwH6J.js";import"./award-DuErkQHu.js";/**
 * @license lucide-react v0.456.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=os("UserPen",[["path",{d:"M11.5 15H7a4 4 0 0 0-4 4v2",key:"15lzij"}],["path",{d:"M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"1817ys"}],["circle",{cx:"10",cy:"7",r:"4",key:"e45bow"}]]),ks=({setEditProfile:b})=>{var u,r,p,f,c,o,n,B,P,F,i,O,A,k;const{user:e,isLoading:x}=G(),{t}=T(),m=I=>{switch(I){case"Bronze":return t("Profile.profileHeader.badge.Bronze");case"Silver":return t("Profile.profileHeader.badge.Silver");case"Gold":return t("Profile.profileHeader.badge.Gold");case"Platinum":return t("Profile.profileHeader.badge.Platinum");case"Diamond":return t("Profile.profileHeader.badge.Diamond");case"Ft-Pong":return t("Profile.profileHeader.badge.Ft-Pong");default:return I}};return s.jsxs("div",{className:j.profileHeaderContainer,children:[s.jsx("div",{className:j.profileBackground,children:s.jsx("div",{className:j.friendState,children:s.jsxs("button",{className:j.editProfileBtn,onClick:()=>b(!0),children:[s.jsx(Is,{color:"#F8C25C"}),s.jsx("span",{children:t("Profile.profileHeader.EditProfileButton")})]})})}),x?s.jsxs("div",{className:"w-[150px] h-[200px] absolute left-1/2 top-[45%] transform -translate-x-1/2 text-center rounded-lg animate-pulse flex flex-col items-center",children:[s.jsx("div",{className:"w-[150px] h-[150px] relative",children:s.jsx("div",{className:"w-full h-full rounded-[25px] bg-gray-700"})}),s.jsx("div",{className:"w-[100px] h-[20px] bg-gray-700 rounded-md mt-4"})]}):s.jsxs("div",{className:j.profileCard,children:[s.jsxs("div",{className:j.avatarContainer,children:[s.jsx("img",{src:(u=e==null?void 0:e.profile)==null?void 0:u.avatar,alt:"",className:j.profileAvatar}),s.jsx("span",{className:j.profileLevel,children:((r=e==null?void 0:e.profile)==null?void 0:r.level)||0})]}),s.jsx("h2",{children:e==null?void 0:e.username})]}),s.jsxs("div",{className:j.profileStats,children:[s.jsxs("div",{className:j.leftStats,children:[s.jsxs("div",{className:j.totalGames,children:[x?s.jsx("span",{className:"statValueSkeleton block w-[40px] h-[40px] bg-gray-500 rounded-md animate-pulse"}):s.jsx("span",{className:j.statValue,children:((f=(p=e==null?void 0:e.profile)==null?void 0:p.stats)==null?void 0:f.games_played)||0}),s.jsx("span",{className:j.statLabel,children:t("Profile.profileHeader.profileStats.games")})]}),s.jsxs("div",{className:j.wins,children:[x?s.jsx("span",{className:"statValueSkeleton block w-[40px] h-[40px] bg-gray-500 rounded-md animate-pulse"}):s.jsx("span",{className:j.statValue,children:((o=(c=e==null?void 0:e.profile)==null?void 0:c.stats)==null?void 0:o.wins)||0}),s.jsx("span",{className:j.statLabel,children:t("Profile.profileHeader.profileStats.wins")})]}),s.jsxs("div",{className:j.loses,children:[x?s.jsx("span",{className:"statValueSkeleton block w-[40px] h-[40px] bg-gray-500 rounded-md animate-pulse"}):s.jsx("span",{className:j.statValue,children:((B=(n=e==null?void 0:e.profile)==null?void 0:n.stats)==null?void 0:B.losses)||0}),s.jsx("span",{className:j.statLabel,children:t("Profile.profileHeader.profileStats.loses")})]})]}),s.jsxs("div",{className:j.leftStats,children:[s.jsxs("div",{className:j.badge,children:[x?s.jsx("span",{className:"statValueSkeleton block w-[40px] h-[40px] bg-gray-500 rounded-md animate-pulse"}):s.jsx("img",{src:(F=(P=e==null?void 0:e.profile)==null?void 0:P.badge)==null?void 0:F.icon,alt:"",className:j.badgeIcon}),s.jsx("span",{className:j.statLabel,children:m(((O=(i=e==null?void 0:e.profile)==null?void 0:i.badge)==null?void 0:O.name)||"")})]}),s.jsxs("div",{className:j.score,children:[x?s.jsx("span",{className:"statValueSkeleton block w-[40px] h-[40px] bg-gray-500 rounded-md animate-pulse"}):s.jsx("span",{className:j.statValue,children:((A=e==null?void 0:e.profile)==null?void 0:A.score)||0}),s.jsx("span",{className:j.statLabel,children:t("Profile.profileHeader.profileStats.score")})]}),s.jsxs("div",{className:j.rank,children:[x?s.jsx("span",{className:"statValueSkeleton block w-[40px] h-[40px] bg-gray-500 rounded-md animate-pulse"}):s.jsx("span",{className:j.statValue,children:((k=e==null?void 0:e.profile)==null?void 0:k.rank)||0}),s.jsx("span",{className:j.statLabel,children:t("Profile.profileHeader.profileStats.rank")})]})]})]})]})};function as(b){return Ps({tag:"svg",attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"},child:[]}]})(b)}const Ls=()=>{const[b,e]=v.useState(!0),x=ts(),{data:t,isLoading:m,error:u}=X(rs),{data:r,isLoading:p,error:f}=X(ls),{t:c}=T();return s.jsxs("div",{className:h.profileFriendsContainer,children:[s.jsxs("div",{className:h.friendsHeader,children:[s.jsxs("div",{className:h.friendsTitle,children:[s.jsx(ws,{size:30,color:"#f8c25c"}),s.jsx("h3",{children:c("Profile.friends.title")})]}),s.jsx("button",{className:h.viewMore,onClick:()=>x("/friends"),children:c("Profile.friends.viewMore")})]}),s.jsxs("div",{className:h.friendsList,children:[s.jsxs("div",{className:h.buttonsGrp,children:[s.jsx("button",{onClick:()=>e(!0),className:`${h.button} ${b?h.buttonActive:""}`,children:c("Profile.friends.buttons.online")}),s.jsx("button",{onClick:()=>e(!1),className:`${h.button} ${b?"":h.buttonActive}`,children:c("Profile.friends.buttons.offline")})]}),b?m?s.jsxs(s.Fragment,{children:[" ",s.jsx(Q,{})," ",s.jsx(Q,{})," "]}):s.jsxs("div",{className:h.friendList,children:[u&&s.jsx("p",{children:u.message}),t&&t.length==0&&s.jsxs("div",{className:h.noFriends,children:[s.jsx("span",{className:h.noCurrentFriend,children:c("Profile.friends.errors.noOnlineFriends")}),s.jsxs("button",{className:h.addFriendsBtn,onClick:()=>x("/friends"),children:[s.jsx(as,{size:"2.2rem"}),s.jsx("span",{children:c("Profile.friends.addFriends.button")})]})]}),t&&t.length>0&&(t==null?void 0:t.map(o=>s.jsxs("div",{className:h.friendItem,children:[s.jsx("img",{src:o.profile.avatar,alt:o.username,className:h.avatar}),s.jsxs("div",{className:h.friendInfo,children:[s.jsx("span",{className:h.name,onClick:()=>x(`/profile/${o.username}`),children:o.username}),s.jsxs("span",{className:h.level,children:[c("Profile.friends.profile.level")," ",o.profile.level]})]}),s.jsxs("div",{className:`${h.status} ${h.online}`,children:[s.jsx("span",{className:h.statusIndicator}),c("Profile.friends.profile.status.online")]})]},o.id)))]}):p?s.jsxs(s.Fragment,{children:[" ",s.jsx(Q,{})," ",s.jsx(Q,{})," "]}):s.jsxs("div",{className:h.friendList,children:[f&&s.jsx("p",{children:f.message}),r&&r.length==0&&s.jsxs("div",{className:h.noFriends,children:[s.jsx("span",{className:h.noCurrentFriend,children:c("Profile.friends.errors.noOfflineFriends")}),s.jsxs("button",{className:h.addFriendsBtn,onClick:()=>x("/friends"),children:[s.jsx(as,{size:"2.2rem"}),s.jsx("span",{children:c("Profile.friends.addFriends.button")})]})]}),r&&r.length>0&&(r==null?void 0:r.map(o=>s.jsxs("div",{className:h.friendItem,children:[s.jsx("img",{src:o.profile.avatar,alt:o.username,className:h.avatar}),s.jsxs("div",{className:h.friendInfo,children:[s.jsx("span",{className:h.name,onClick:()=>x(`/profile/${o.username}`),children:o.username}),s.jsxs("span",{className:h.level,children:[c("Profile.friends.profile.level")," ",o.profile.level]})]}),s.jsxs("div",{className:`${h.status} ${h.offline}`,children:[s.jsx("span",{className:h.statusIndicator}),c("Profile.friends.profile.status.offline")]})]},o.id)))]})]})]})},Os="_editInfosContainer_1binb_1",Rs="_title_1binb_13",Vs="_editInfosBody_1binb_20",$s="_editInfosForm_1binb_30",Hs="_emailContainer_1binb_42",Ms="_editAvatar_1binb_52",qs="_avatarContainer_1binb_61",Ts="_defaultAvatar_1binb_75",Ds="_avatarButtons_1binb_79",Gs="_avatarBtn_1binb_89",zs="_removeAvatarBtn_1binb_89",Qs="_editInfos_1binb_1",Us="_containerField_1binb_123",Ws="_field_1binb_132",Js="_label_1binb_138",Ks="_input_1binb_144",Ys="_emailInput_1binb_144",Zs="_saveBtn_1binb_166",Xs="_formsContainer_1binb_183",se="_formProfile_1binb_192",ee="_formSecurity_1binb_198",ae="_bluredBgConfirm_1binb_204",te="_saveConfirmContainer_1binb_215",ne="_editEmailContainer_1binb_231",ie="_ConfirmButtons_1binb_259",oe="_confirmBtn_1binb_264",re="_closeBtn_1binb_264",le="_fieldError_1binb_273",ce="_emailField_1binb_292",de="_editEmailBtn_1binb_308",l={editInfosContainer:Os,title:Rs,editInfosBody:Vs,editInfosForm:$s,emailContainer:Hs,editAvatar:Ms,avatarContainer:qs,defaultAvatar:Ts,avatarButtons:Ds,avatarBtn:Gs,removeAvatarBtn:zs,editInfos:Qs,containerField:Us,field:Ws,label:Js,input:Ks,emailInput:Ys,saveBtn:Zs,formsContainer:Xs,formProfile:se,formSecurity:ee,bluredBgConfirm:ae,saveConfirmContainer:te,editEmailContainer:ne,ConfirmButtons:ie,confirmBtn:oe,closeBtn:re,fieldError:le,emailField:ce,editEmailBtn:de},me=()=>{const{register:b,handleSubmit:e,formState:{errors:x,isValid:t},reset:m,watch:u,setError:r,setValue:p}=U({resolver:W(gs()),mode:"onSubmit"}),f=J({mutationFn:async c=>await H.put(cs,c),onError:c=>{var o;if($.isAxiosError(c)){const n=(o=c==null?void 0:c.response)==null?void 0:o.data;n!=null&&n.username&&r("username",{type:"",message:n==null?void 0:n.username},{shouldFocus:!0}),n!=null&&n.first_name&&r("first_name",{type:"",message:n==null?void 0:n.first_name},{shouldFocus:!0}),n!=null&&n.last_name&&r("last_name",{type:"",message:n==null?void 0:n.last_name},{shouldFocus:!0}),n!=null&&n.password&&r("password",{type:"",message:n==null?void 0:n.password},{shouldFocus:!0}),n!=null&&n.avatar&&r("avatar",{type:"",message:n==null?void 0:n.avatar},{shouldFocus:!0}),n!=null&&n.error&&r("root",{type:"",message:n==null?void 0:n.error})}else r("root",{type:"",message:"Something went wrong!"})}});return{register:b,handleSubmit:e,errors:x,isValid:t,mutation:f,reset:m,setValue:p,watch:u,setError:r}},ue=({setEditProfile:b})=>{const{register:e,handleSubmit:x,mutation:t,reset:m,errors:u,watch:r,setValue:p}=me(),[f,c]=v.useState(!1),[o,n]=v.useState(null),[B,P]=v.useState(!1),F=v.useRef(null),{user:i,refetch:O}=G(),A=r(["username","first_name","last_name"]),[k,I]=v.useState(""),[R,_]=v.useState(""),{t:N}=T(),K=w=>{console.log("data == ",w);const y=new FormData;w.avatar&&y.append("avatar",w.avatar),o==="remove"&&y.append("removeAvatar","true"),w.username&&y.append("username",w.username),y.append("first_name",w.first_name),y.append("last_name",w.last_name),w.password&&y.append("password",w.password),t.mutate(y)},z=w=>{var y;w.preventDefault(),(y=F.current)==null||y.click()},V=w=>{var C;const y=(C=w.target.files)==null?void 0:C[0];if(y){p("avatar",y);const D=URL.createObjectURL(y);n(D)}};v.useEffect(()=>{var y,C;const w=async()=>{const D=await O();console.log("refetch result == ",D)};t.isSuccess&&(w(),S.success((C=(y=t.data)==null?void 0:y.data)==null?void 0:C.message),m(),b(!1))},[t.isSuccess]),v.useEffect(()=>{u&&u.password||u.root&&(S.error(u.root.message),c(!1),t.reset())}),t.isError;const Y=()=>A[0]===void 0&&A[1]===void 0&&A[2]===void 0&&o===null?!0:A[0]===(i==null?void 0:i.username)&&A[1]===(i==null?void 0:i.first_name)&&A[2]===(i==null?void 0:i.last_name)&&!o,Z=async()=>{var w,y;try{await Cs().validate({email:k})}catch(C){if(C instanceof ns){_(C.message);return}else _("Invalid email");return}try{const C=await H.post(ms,{email:k});S.success(C.data.message),b(!1)}catch(C){$.isAxiosError(C)?S.error((y=(w=C==null?void 0:C.response)==null?void 0:w.data)==null?void 0:y.error):S.error(N("Profile.EditInfosProfile.errors.defaultError"))}};return s.jsxs("div",{className:l.editInfosContainer,children:[s.jsx("h1",{className:l.title,children:N("Profile.EditInfosProfile.title")}),s.jsxs("form",{className:l.editInfosForm,onSubmit:x(K),children:[s.jsxs("div",{className:l.editAvatar,children:[s.jsx("div",{className:l.avatarContainer,children:s.jsx("img",{src:o?o==="remove"?ds:o:i==null?void 0:i.profile.avatar,alt:""})}),s.jsxs("div",{className:l.avatarButtons,children:[s.jsx("input",{type:"file",accept:"image/*",...e("avatar"),ref:w=>{e("avatar"),F.current=w},onChange:V}),s.jsx("button",{className:l.avatarBtn,type:"button",onClick:z,children:N("Profile.EditInfosProfile.avatar.changeButton")}),s.jsx("button",{className:l.removeAvatarBtn,disabled:o==="remove",type:"button",onClick:w=>{w.preventDefault(),n("remove")},children:N("Profile.EditInfosProfile.avatar.removeButton")}),u.avatar&&s.jsx("span",{className:l.fieldError,children:u.avatar.message})]})]}),s.jsxs("div",{className:l.editInfos,children:[s.jsxs("div",{className:l.containerField,children:[s.jsxs("div",{className:l.field,children:[s.jsx("label",{htmlFor:"",className:l.label,children:N("Profile.EditInfosProfile.fields.firstName.label")}),s.jsx("input",{className:l.input,defaultValue:i==null?void 0:i.first_name,placeholder:i!=null&&i.first_name?"":N("Profile.EditInfosProfile.fields.firstName.placeholder"),...e("first_name")})]}),u.first_name&&s.jsx("span",{className:l.fieldError,children:u.first_name.message})]}),s.jsxs("div",{className:l.containerField,children:[s.jsxs("div",{className:l.field,children:[s.jsx("label",{htmlFor:"",className:l.label,children:N("Profile.EditInfosProfile.fields.lastName.label")}),s.jsx("input",{type:"text",className:l.input,defaultValue:i==null?void 0:i.last_name,placeholder:i!=null&&i.last_name?"":N("Profile.EditInfosProfile.fields.lastName.placeholder"),...e("last_name")})]}),u.last_name&&s.jsx("span",{className:l.fieldError,children:u.last_name.message})]}),s.jsxs("div",{className:l.containerField,children:[s.jsxs("div",{className:l.field,children:[s.jsx("label",{htmlFor:"",className:l.label,children:N("Profile.EditInfosProfile.fields.username.label")}),s.jsx("input",{type:"text",className:l.input,defaultValue:i==null?void 0:i.username,placeholder:i!=null&&i.username?"":N("Profile.EditInfosProfile.fields.username.placeholder"),...e("username")})]}),u.username&&s.jsx("span",{className:l.fieldError,children:u.username.message})]}),s.jsx("button",{type:"button",disabled:Y(),onClick:()=>c(!0),className:l.saveBtn,children:N("Profile.EditInfosProfile.saveButton")})]}),f&&s.jsx("div",{className:l.bluredBgConfirm,children:s.jsxs("div",{className:l.saveConfirmContainer,children:[s.jsx("h1",{children:N("Profile.EditInfosProfile.confirmSave.title")}),s.jsx("p",{children:N("Profile.EditInfosProfile.confirmSave.description")}),s.jsxs("div",{className:l.containerFiled,children:[s.jsx("label",{htmlFor:"",children:N("Profile.EditInfosProfile.fields.password.label")}),s.jsx("input",{type:"password",className:l.input,placeholder:N("Profile.EditInfosProfile.fields.password.placeholder"),...e("password")}),u.password&&s.jsx("span",{className:l.fieldError,children:u.password.message})]}),s.jsxs("div",{className:l.ConfirmButtons,children:[s.jsx("button",{type:"reset",className:l.closeBtn,onClick:()=>c(!1),children:N("Profile.EditInfosProfile.confirmSave.buttons.close")}),s.jsx("button",{type:"submit",className:l.confirmBtn,children:N("Profile.EditInfosProfile.confirmSave.buttons.confirm")})]})]})})]}),s.jsxs("div",{className:l.emailContainer,children:[s.jsx("label",{htmlFor:"",className:l.label,children:N("Profile.EditInfosProfile.fields.email.label")}),s.jsxs("div",{className:l.emailField,children:[s.jsx("p",{children:i==null?void 0:i.email}),s.jsx("button",{className:l.editEmailBtn,type:"button",onClick:()=>P(!0),children:N("editEmail.btnEdit")})]}),R&&s.jsx("span",{className:l.fieldError,children:R})]}),s.jsx("div",{className:`${B?l.bluredBgConfirm:""}`,children:B&&s.jsxs("div",{className:l.editEmailContainer,children:[s.jsx("h1",{children:N("editEmail.editEmail")}),s.jsx("p",{children:N("editEmail.description")}),s.jsxs("div",{className:l.field,children:[s.jsx("label",{className:l.label,children:N("editEmail.label")}),s.jsx("input",{type:"email",className:l.emailInput,placeholder:N("Profile.EditInfosProfile.fields.email.placeholder"),onChange:w=>I(w.target.value)}),R&&s.jsx("span",{className:l.fieldError,children:R})]}),s.jsxs("div",{className:l.ConfirmButtons,children:[s.jsx("button",{className:l.closeBtn,type:"reset",onClick:()=>P(!1),children:N("editEmail.btnCancel")}),s.jsx("button",{type:"button",className:l.confirmBtn,onClick:Z,children:N("editEmail.btnSubmit")})]})]})})]})},fe="_securityContainer_9mys9_1",pe="_UpdatePassContainer_9mys9_10",he="_title_9mys9_20",xe="_changePassForm_9mys9_26",_e="_entryArea_9mys9_34",je="_containerFiled_9mys9_43",be="_label_9mys9_51",Ne="_passContainer_9mys9_56",ve="_input_9mys9_63",Pe="_showPassIcon_9mys9_74",we="_ConfirmButtons_9mys9_81",ge="_confirmBtn_9mys9_90",Ce="_closeBtn_9mys9_90",ye="_twoFacForm_9mys9_115",Ee="_twoFacContainer_9mys9_128",Se="_inputContainer_9mys9_137",Be="_otpAndInput_9mys9_146",Fe="_labelIcon_9mys9_151",Ae="_mobileMsgIcon_9mys9_162",Ie="_description_9mys9_167",ke="_inputBtn_9mys9_172",Le="_verifCode_9mys9_179",Oe="_enableBtn_9mys9_190",Re="_qrCodeContainer_9mys9_205",Ve="_qrCodeContainerApp_9mys9_230",$e="_fieldError_9mys9_243",He="_disable2faContainer_9mys9_249",Me="_disableBtn_9mys9_257",qe="_downloadBtn_9mys9_270",Te="_popupOverlay_9mys9_284",De="_popup_9mys9_284",Ge="_osButtons_9mys9_315",ze="_closePopup_9mys9_330",Qe="_qrCode_9mys9_205",Ue="_selected_9mys9_351",We="_appLink_9mys9_355",a={securityContainer:fe,UpdatePassContainer:pe,title:he,changePassForm:xe,entryArea:_e,containerFiled:je,label:be,passContainer:Ne,input:ve,showPassIcon:Pe,ConfirmButtons:we,confirmBtn:ge,closeBtn:Ce,twoFacForm:ye,twoFacContainer:Ee,inputContainer:Se,otpAndInput:Be,labelIcon:Fe,mobileMsgIcon:Ae,description:Ie,inputBtn:ke,verifCode:Le,enableBtn:Oe,qrCodeContainer:Re,qrCodeContainerApp:Ve,fieldError:$e,disable2faContainer:He,disableBtn:Me,downloadBtn:qe,popupOverlay:Te,popup:De,osButtons:Ge,closePopup:ze,qrCode:Qe,selected:Ue,appLink:We},Je=()=>{const{register:b,handleSubmit:e,formState:{errors:x},reset:t,watch:m,setError:u,setValue:r}=U({resolver:W(ys()),reValidateMode:"onChange",mode:"onChange"}),p=J({mutationFn:async f=>await H.put(us,f),onError:f=>{var c;if($.isAxiosError(f)){const o=(c=f==null?void 0:f.response)==null?void 0:c.data;o!=null&&o.current_password&&u("current_password",{type:"manual",message:o.current_password},{shouldFocus:!0}),o!=null&&o.new_password&&(Array.isArray(o.password)?u("new_password",{type:"manual",message:o.new_password.join("-")},{shouldFocus:!0}):u("new_password",{type:"manual",message:o.new_password},{shouldFocus:!0})),o!=null&&o.error&&u("root",{type:"manual",message:o.error})}else u("root",{type:"",message:"Something went wrong!"})}});return{register:b,handleSubmit:e,errors:x,mutation:p,reset:t,setValue:r,watch:m,setError:u}},Ke=({setEditProfile:b})=>{const{register:e,handleSubmit:x,errors:t,mutation:m,reset:u}=Je(),[r,p]=v.useState(null),[f,c]=v.useState(null),[o,n]=v.useState(null),[B,P]=v.useState(null),{user:F,isLoading:i,refetch:O}=G(),[A,k]=v.useState(!1),[I,R]=v.useState(""),{t:_}=T(),N=()=>k(!0),K=()=>{k(!1),R("")},z=E=>R(E);if(i)return;const[V,Y]=v.useState({current_pass:!1,new_pass:!1,confirm_pass:!1,pass2fa:!1}),Z=async()=>{var E,L;try{const g=await H.post(hs,{password:B});S.success(g.data.message),b(!1),O()}catch(g){$.isAxiosError(g)?S.error((L=(E=g==null?void 0:g.response)==null?void 0:E.data)==null?void 0:L.error):S.error(_("Profile.EditSecurity.errors.defaultError"))}},w=async()=>{var E,L;try{await Es(_).validate({otp:f})}catch(g){g instanceof ns?(n(g.message),console.log("error.message == ",g.message)):(console.log("error == ",g),n("Error otp, try again!"));return}try{const g=await H.post(xs,{otp:f});S.success(g.data.message),b(!1),O()}catch(g){$.isAxiosError(g)?S.error((L=(E=g==null?void 0:g.response)==null?void 0:E.data)==null?void 0:L.error):S.error(_("Profile.EditSecurity.errors.defaultError"))}},y=async()=>{var E,L;try{const g=await H.post(_s,{});p(g.data.qr_code)}catch(g){$.isAxiosError(g)?S.error((L=(E=g==null?void 0:g.response)==null?void 0:E.data)==null?void 0:L.error):S.error(_("Profile.EditSecurity.errors.defaultError")),p(null)}},C=E=>{Y(L=>({...L,[E]:!L[E]}))};v.useEffect(()=>{var E,L;m.isSuccess&&(S.success((L=(E=m.data)==null?void 0:E.data)==null?void 0:L.message),b(!1))},[m.isSuccess]),v.useEffect(()=>{}),m.isError;const D=E=>{m.mutate(E)};return s.jsxs("div",{className:a.securityContainer,children:[s.jsxs("div",{className:a.UpdatePassContainer,children:[s.jsx("h1",{className:a.title,children:_("Profile.EditSecurity.changePassword.title")}),s.jsxs("form",{action:"submit",className:a.changePassForm,onSubmit:x(D),children:[s.jsxs("div",{className:a.entryArea,children:[s.jsxs("div",{className:a.containerFiled,children:[s.jsx("label",{htmlFor:"",className:a.label,children:_("Profile.EditSecurity.changePassword.currentPassword")}),s.jsxs("div",{className:a.passContainer,children:[s.jsx("input",{type:V.current_pass?"text":"password",className:a.input,...e("current_password")}),V.current_pass?s.jsx(M,{className:a.showPassIcon,onClick:()=>C("current_pass")}):s.jsx(q,{className:a.showPassIcon,onClick:()=>C("current_pass")})]}),t.current_password&&s.jsx("span",{className:a.fieldError,children:t.current_password.message})]}),s.jsxs("div",{className:a.containerFiled,children:[s.jsx("label",{htmlFor:"",className:a.label,children:_("Profile.EditSecurity.changePassword.newPassword")}),s.jsxs("div",{className:a.passContainer,children:[s.jsx("input",{type:V.new_pass?"text":"password",className:a.input,...e("new_password")}),V.new_pass?s.jsx(M,{className:a.showPassIcon,onClick:()=>C("new_pass")}):s.jsx(q,{className:a.showPassIcon,onClick:()=>C("new_pass")})]}),t.new_password&&s.jsx("span",{className:a.fieldError,children:t.new_password.message})]}),s.jsxs("div",{className:a.containerFiled,children:[s.jsx("label",{htmlFor:"",className:a.label,children:_("Profile.EditSecurity.changePassword.confirmPassword")}),s.jsxs("div",{className:a.passContainer,children:[s.jsx("input",{type:V.confirm_pass?"text":"password",className:a.input,...e("confirm_password")}),V.confirm_pass?s.jsx(M,{className:a.showPassIcon,onClick:()=>C("confirm_pass")}):s.jsx(q,{className:a.showPassIcon,onClick:()=>C("confirm_pass")})]}),t.confirm_password&&s.jsx("span",{className:a.fieldError,children:t.confirm_password.message})]})]}),s.jsxs("div",{className:a.ConfirmButtons,children:[s.jsx("button",{type:"reset",className:a.closeBtn,onClick:()=>u(),children:_("Profile.EditSecurity.changePassword.buttons.reset")}),s.jsx("button",{type:"submit",className:a.confirmBtn,children:_("Profile.EditSecurity.changePassword.buttons.save")})]})]})]}),s.jsxs("div",{className:a.twoFacForm,children:[s.jsx("h1",{className:a.title,children:_("Profile.EditSecurity.twoFactorAuth.title")}),F!=null&&F.is2fa_active?s.jsxs("div",{className:a.disable2faContainer,children:[s.jsx("p",{children:_("Profile.EditSecurity.twoFactorAuth.enabled.status")}),s.jsx("p",{children:_("Profile.EditSecurity.twoFactorAuth.ask_disable")}),s.jsxs("div",{className:a.containerFiled,children:[s.jsx("label",{htmlFor:"",className:a.label,children:_("Profile.EditSecurity.twoFactorAuth.enabled.confirmPasswordLabel")}),s.jsxs("div",{className:a.passContainer,children:[s.jsx("input",{type:V.pass2fa?"text":"password",className:a.input,onChange:E=>P(E.target.value)}),V.pass2fa?s.jsx(M,{className:a.showPassIcon,onClick:()=>C("pass2fa")}):s.jsx(q,{className:a.showPassIcon,onClick:()=>C("pass2fa")})]})]}),s.jsx("button",{disabled:!B||(B==null?void 0:B.length)===0,className:a.disableBtn,onClick:Z,children:_("Profile.EditSecurity.twoFactorAuth.enabled.buttons.disable2FA")})]}):s.jsxs("div",{className:a.twoFacContainer,children:[s.jsxs("div",{className:a.inputContainer,children:[s.jsx("p",{className:a.description,children:_("Profile.EditSecurity.twoFactorAuth.description")}),s.jsxs("div",{className:a.otpAndInput,children:[s.jsxs("div",{className:a.labelIcon,children:[s.jsx(Fs,{className:a.mobileMsgIcon}),s.jsx("label",{children:_("Profile.EditSecurity.twoFactorAuth.mobileMessageLabel")})]}),s.jsxs("div",{className:a.inputBtn,children:[s.jsx("input",{type:"text",className:a.verifCode,placeholder:_("Profile.EditSecurity.twoFactorAuth.otpPlaceholder"),onChange:E=>c(E.target.value)}),s.jsx("button",{disabled:!r,className:a.enableBtn,onClick:w,children:_("Profile.EditSecurity.twoFactorAuth.buttons.enable2FA")})]}),o&&s.jsx("span",{className:a.fieldError,children:o})]})]}),s.jsxs("div",{className:a.qrCodeContainer,children:[s.jsx("button",{className:a.downloadBtn,onClick:N,children:_("Profile.EditSecurity.twoFactorAuth.buttons.downloadApp")}),r?s.jsx("img",{className:a.qrCode,src:r,alt:"QR Code"}):s.jsx("button",{onClick:y,children:_("Profile.EditSecurity.twoFactorAuth.buttons.getQrCode")})]})]}),A&&s.jsx("div",{className:a.popupOverlay,children:s.jsxs("div",{className:a.popup,children:[s.jsx("h2",{children:_("Profile.EditSecurity.downloadAppPopup.title")}),s.jsxs("div",{className:a.osButtons,children:[s.jsx("button",{onClick:()=>z("android"),className:`${I==="android"?a.selected:""}`,children:_("Profile.EditSecurity.downloadAppPopup.osButtons.android")}),s.jsx("button",{onClick:()=>z("ios"),className:`${I==="ios"?a.selected:""}`,children:_("Profile.EditSecurity.downloadAppPopup.osButtons.ios")})]}),I&&s.jsxs("div",{className:a.qrCodeContainerApp,children:[s.jsx("p",{children:_("Profile.EditSecurity.downloadAppPopup.qrCodeInstructions")}),s.jsx("img",{src:I==="android"?fs:ps,alt:`${I} QR Code`}),s.jsx("a",{className:a.appLink,href:I==="android"?ss:es,target:"_blank",children:I==="android"?ss:es})]}),s.jsx("button",{className:a.closePopup,onClick:K,children:_("Profile.EditSecurity.downloadAppPopup.buttons.close")})]})})]})]})},Ye=()=>{const{register:b,handleSubmit:e,formState:{errors:x},reset:t,setError:m,clearErrors:u}=U({resolver:W(Ss()),reValidateMode:"onChange",mode:"onChange"}),r=J({mutationFn:async p=>await H.post(js,p),onError:p=>{var f;if($.isAxiosError(p)){const c=(f=p==null?void 0:p.response)==null?void 0:f.data;c!=null&&c.password&&(Array.isArray(c.password)?m("password",{type:"manual",message:c.password.join("-")},{shouldFocus:!0}):m("password",{type:"manual",message:c.password},{shouldFocus:!0})),c!=null&&c.error&&m("root",{type:"manual",message:c.error})}else m("root",{type:"",message:"Something went wrong!"})}});return{register:b,handleSubmit:e,errors:x,mutation:r,reset:t,setError:m,clearErrors:u}},Ze=({setEditProfile:b})=>{const{register:e,handleSubmit:x,errors:t,mutation:m,reset:u}=Ye(),{refetch:r}=G(),{t:p}=T(),[f,c]=v.useState({new_pass:!1,confirm_pass:!1}),o=P=>{P.target.classList.contains(d.bluredBg)&&b(!1)},n=P=>{c(F=>({...F,[P]:!F[P]}))},B=P=>{m.mutate(P)};return v.useEffect(()=>{var P,F,i,O,A,k;m.isSuccess&&(r(),(F=(P=m==null?void 0:m.data)==null?void 0:P.data)!=null&&F.message?(console.log("message:>: ",(O=(i=m==null?void 0:m.data)==null?void 0:i.data)==null?void 0:O.message),S.success(p("Profile.setPassword.successMessage"))):(console.log("else message:>: ",(k=(A=m==null?void 0:m.data)==null?void 0:A.data)==null?void 0:k.message),S.success(p("Profile.setPassword.successMessage"))),b(!1))},[m.isSuccess]),v.useEffect(()=>{var P;m.isError&&t!=null&&t.root&&S.error((P=t.root)==null?void 0:P.message)},[m.isError]),s.jsx("div",{className:d.bluredBg,onClick:o,children:s.jsxs("div",{className:d.setPassContainer,children:[s.jsx("button",{className:d.exitBtn,onClick:()=>b(!1),children:s.jsx(is,{})}),s.jsxs("form",{action:"submit",onSubmit:x(B),children:[s.jsxs("div",{className:d.formHeader,children:[s.jsx("h1",{children:p("Profile.setPassword.title")}),s.jsx("p",{children:p("Profile.setPassword.description")})]}),s.jsxs("div",{className:d.inputFields,children:[s.jsxs("div",{className:d.containerFiled,children:[s.jsx("label",{htmlFor:"",className:d.label,children:p("Profile.setPassword.fields.newPassword")}),s.jsxs("div",{className:d.inputContainer,children:[s.jsx("input",{type:f.new_pass?"text":"password",className:d.input,...e("password")}),f.new_pass?s.jsx(M,{className:d.showPassIcon,onClick:()=>n("new_pass")}):s.jsx(q,{className:d.showPassIcon,onClick:()=>n("new_pass")})]}),t.password&&s.jsx("span",{className:d.fieldError,children:t.password.message})]}),s.jsxs("div",{className:d.containerFiled,children:[s.jsx("label",{htmlFor:"",className:d.label,children:p("Profile.setPassword.fields.confirmPassword")}),s.jsxs("div",{className:d.inputContainer,children:[s.jsx("input",{type:f.confirm_pass?"text":"password",className:d.input,...e("password2")}),f.confirm_pass?s.jsx(M,{className:d.showPassIcon,onClick:()=>n("confirm_pass")}):s.jsx(q,{className:d.showPassIcon,onClick:()=>n("confirm_pass")})]}),t.password2&&s.jsx("span",{className:d.fieldError,children:t.password2.message})]}),s.jsxs("div",{className:d.ConfirmButtons,children:[s.jsx("button",{type:"reset",className:d.closeBtn,onClick:()=>u(),children:p("Profile.setPassword.buttons.reset")}),s.jsx("button",{type:"submit",className:d.confirmBtn,children:p("Profile.setPassword.buttons.save")})]})]})]})]})})},Xe=()=>{const{register:b,handleSubmit:e,formState:{errors:x},reset:t,setError:m}=U({resolver:W(Bs()),mode:"onSubmit"}),u=J({mutationFn:async r=>await H.post(bs,r),onError:r=>{var p;if($.isAxiosError(r)){const f=(p=r==null?void 0:r.response)==null?void 0:p.data;f!=null&&f.password&&m("password",{type:"manual",message:f.password},{shouldFocus:!0}),f!=null&&f.error&&m("root",{type:"manual",message:f.error})}else m("root",{type:"manual",message:"Something went wrong!"})}});return{register:b,handleSubmit:e,errors:x,mutation:u,reset:t}},ua=()=>{var k,I;const[b,e]=v.useState(!1),[x,t]=v.useState(!0),[m,u]=v.useState(!1),{user:r,error:p,refetch:f,isLoading:c}=G(),{register:o,handleSubmit:n,errors:B,mutation:P,reset:F}=Xe(),{t:i}=T(),O=ts();v.useEffect(()=>{f()},[]);const A=R=>{R.target.classList.contains(d.bluredBg)&&e(!1)};if(v.useEffect(()=>{P.isSuccess&&(S.success("Account deleted successfully!"),F(),O("/auth"))},[P.isSuccess]),v.useEffect(()=>{P.isError&&B.root&&S.error(B.root.message)},[P.isError]),!c)return p&&($.isAxiosError(p)?S.error(((I=(k=p.response)==null?void 0:k.data)==null?void 0:I.message)||"Something went wrong, try again!"):S.error("Something went wrong, try again!"),O("/")),s.jsxs("div",{className:d.profileContainer,children:[b&&(r!=null&&r.is_password_set?s.jsx("div",{className:d.bluredBg,onClick:A,children:s.jsxs("div",{className:d.editProfileContainer,children:[s.jsx("button",{className:d.exitBtn,onClick:()=>e(!1),children:s.jsx(is,{})}),s.jsxs("div",{className:d.editProfileForm,children:[s.jsxs("div",{className:d.buttonsGrp,children:[s.jsx("button",{onClick:()=>t(!0),className:`${d.button} ${x?d.buttonActive:""}`,children:i("Profile.informations")}),s.jsx("button",{onClick:()=>t(!1),className:`${d.button} ${x?"":d.buttonActive}`,children:i("Profile.security")})]}),x?s.jsx(ue,{setEditProfile:e}):s.jsx(Ke,{setEditProfile:e}),!x&&s.jsxs("button",{className:d.deleteAccBtn,onClick:()=>u(!0),children:[s.jsx(As,{size:"2.2rem"}),s.jsx("span",{children:i("deleteAccount.btnDelete")})]}),m&&s.jsx("div",{className:d.bluredBgConfirm,children:s.jsxs("form",{className:d.confirmDelAccContainer,onSubmit:n(R=>P.mutate(R)),children:[s.jsx("h1",{children:i("deleteAccount.title")}),s.jsx("p",{children:i("deleteAccount.description")}),s.jsx("p",{children:i("deleteAccount.warning")}),s.jsxs("div",{className:d.containerFiled,children:[s.jsx("label",{htmlFor:"",children:i("Profile.EditInfosProfile.fields.password.label")}),s.jsx("input",{type:"password",className:d.input,...o("password"),placeholder:i("Profile.EditInfosProfile.fields.password.placeholder")}),B.password&&s.jsx("span",{className:d.fieldError,children:B.password.message})]}),s.jsxs("div",{className:d.ConfirmButtons,children:[s.jsx("button",{type:"reset",className:d.closeBtn,onClick:()=>{F(),u(!1)},children:i("Profile.EditInfosProfile.confirmSave.buttons.close")}),s.jsx("button",{type:"submit",className:d.confirmBtn,children:i("Profile.EditInfosProfile.confirmSave.buttons.confirm")})]})]})})]})]})}):s.jsx(Ze,{setEditProfile:e})),s.jsx(ks,{setEditProfile:e}),s.jsxs("div",{className:d.profileBodyConatiner,children:[s.jsx(Ls,{}),s.jsxs("div",{className:d.rightBodyContainer,children:[s.jsx(Ns,{username:r==null?void 0:r.username}),s.jsx(vs,{isOtherUser:!1,username:r==null?void 0:r.username})]})]})]})};export{ua as default};
