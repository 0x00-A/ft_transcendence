import{l as C,ai as b,D as w,i as y,r as c,h as B,f as N,B as a,j as r,y as U}from"./index-erQsObJq.js";import{u as R,o as v,e as O,a as I}from"./formSchemas-CD-5kOut.js";import{F as A}from"./index-DRSugL2N.js";import{O as L}from"./OtpAuth-D4tcUVbL.js";import"./iconBase-Dy7Lu4j7.js";const q=()=>{const{register:m,handleSubmit:p,formState:{errors:_},reset:d,setError:u}=R({resolver:v(O()),reValidateMode:"onChange",mode:"onChange"}),f=I({mutationFn:async n=>await C.post(b,n),onError:n=>{var g;if(w.isAxiosError(n)){const o=(g=n==null?void 0:n.response)==null?void 0:g.data;o!=null&&o.username&&u("username",{type:"manual",message:o.username},{shouldFocus:!0}),o!=null&&o.error&&u("root",{type:"manual",message:o.error})}else u("root",{type:"",message:"Something went wrong!"})}});return{register:m,handleSubmit:p,reset:d,errors:_,setError:u,mutation:f}},H="_oauth2Container_10emi_1",M="_usernameForm_10emi_9",P="_FormHeader_10emi_19",k="_logo_10emi_28",T="_inputContainer_10emi_45",V="_userIcon_10emi_67",D="_fieldError_10emi_77",G="_submitBtn_10emi_86",Y="_authBtn_10emi_98",i={oauth2Container:H,usernameForm:M,FormHeader:P,logo:k,inputContainer:T,userIcon:V,fieldError:D,submitBtn:G,authBtn:Y},X=()=>{const m=y(),[p,_]=c.useState(!1),{setIsLoggedIn:d}=B(),[u,f]=c.useState(!1),[n,g]=c.useState(""),o=N(),{register:S,handleSubmit:E,errors:h,mutation:l,reset:F}=q();c.useEffect(()=>{const s=new URLSearchParams(window.location.search),t=s.get("status");if(t&&t==="2fa_required"){const e=s.get("message");e?a.info(e):a.info("2fa required, please enter otp"),f(!0);const x=s.get("username");x&&g(x)}else if(t&&t==="success"){const e=s.get("message");e?a.success(e):a.success("Login successful, welcome!"),d(!0),m("/")}else if(t&&t==="set_username"){const e=s.get("message");e?a.info(e):a.info("Please set a username to continue"),_(!0)}else if(t&&t==="email_exists"){const e=s.get("message");e?a.error(e):a.error("Email already exists, please login"),m("/auth")}else{const e=s.get("error");t==="failed"&&e?a.error(e):a.error("Something went wrong, please try again"),m("/auth")}},[m]),c.useEffect(()=>{var s,t;l.isSuccess&&(F(),a.success((t=(s=l.data)==null?void 0:s.data)==null?void 0:t.message),d(!0),m("/"))},[l.isSuccess]),c.useEffect(()=>{h.root&&a.error(h.root.message)},[l.isError]);const j=s=>{l.mutate(s)};return r.jsxs("div",{className:i.oauth2Container,children:[u&&r.jsx(L,{setOtpRequired:f,username:n,loadingBarRef:o}),p&&r.jsxs("form",{noValidate:!0,className:i.usernameForm,onSubmit:E(j),children:[r.jsxs("div",{className:i.FormHeader,children:[r.jsx("img",{src:U,alt:"",className:i.logo}),r.jsx("h1",{children:"Your provider username is not valid, or already exist, please choose new one"})]}),r.jsx("p",{children:"Select new username and continue"}),r.jsxs("div",{className:i.inputContainer,children:[r.jsx(A,{className:i.userIcon}),r.jsx("input",{type:"text",placeholder:"username",...S("username")})]}),h.username&&r.jsx("span",{className:i.fieldError,children:h.username.message}),r.jsx("button",{type:"submit",className:i.submitBtn,children:"Submit"})]})]})};export{X as default};
